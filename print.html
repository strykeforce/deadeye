<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Deadeye Vision System</title>
                <meta name="robots" content="noindex" />
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
                <link rel="stylesheet" href="custom.css">
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="quickstart/index.html"><strong aria-hidden="true">2.</strong> Quickstart</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="quickstart/pipeline.html"><strong aria-hidden="true">2.1.</strong> Configure Pipeline</a></li><li class="chapter-item expanded "><a href="quickstart/robot.html"><strong aria-hidden="true">2.2.</strong> Create a Robot</a></li></ol></li><li class="chapter-item expanded "><a href="configuration.html"><strong aria-hidden="true">3.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="architecture.html"><strong aria-hidden="true">4.</strong> Architecture</a></li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">5.</strong> Installation</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Deadeye Vision System</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p><strong>Deadeye</strong> is a vision system for FIRST<sup>®</sup> Robotics Competition
robots designed to be run on a vision coprocessor, such as the <a href="https://developer.nvidia.com/EMBEDDED/jetson-nano-developer-kit/">Jetson Nano
Developer Kit</a>. It consists of several parts:</p>
<ul>
<li>Vision Daemon - C++ vision capture and processing pipeline.</li>
<li>Client Library - Java library for use with FRC robots and other clients</li>
<li>Admin Web UI - React web interface to manage Deadeye vision system.</li>
<li>Admin Server and Tools - Python web service to connect admin web UI to vision
daemon back-end.</li>
<li>Provisioning Tools - Ansible playbooks for provisioning and deploying the
system to vision coprocessors.</li>
</ul>
<h2 id="contributing"><a class="header" href="#contributing">Contributing</a></h2>
<p>Deadeye is free and open source. You can find the source code on
<a href="https://github.com/strykeforce/deadeye">GitHub</a> and issues and feature
requests can be posted on the <a href="https://github.com/strykeforce/deadeye/issues">GitHub issue
tracker</a>. Deadeye relies on our
users to fix bugs and add features: if you'd like to contribute, please
consider opening a <a href="https://github.com/strykeforce/deadeye/pulls">pull
request</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="quickstart"><a class="header" href="#quickstart">Quickstart</a></h1>
<p>This section gets you started using Deadeye with a FRC robot program. It will
work on either a robot or the <a href="https://docs.wpilib.org/en/latest/docs/software/wpilib-tools/robot-simulation/index.html">robot simulator</a> available on your
development workstation.</p>
<p>In this example, we'll upload this target <a href="quickstart/images/target.jpg">test image</a> to
Deadeye. To make things interesting, this image includes extra retro-reflective
tape reflections (&quot;noise&quot;) that will need to be filtered out to isolate the
target correctly.</p>
<img src="quickstart/../images/target.jpg" class="figure figure-90" />
<div style="break-before: page; page-break-before: always;"></div><h2 id="configure-vision-pipeline"><a class="header" href="#configure-vision-pipeline">Configure Vision Pipeline</a></h2>
<p>This example assumes you have a Deadeye unit configured with the
<code>UprightRectPipeline</code> and you can access its admin dashboard from your browser.</p>
<blockquote>
<p>Note: The quickstart pipeline tuning process outline below is good enough for
our single target test image. Real-world usage requires more careful tuning
that takes into account varying field positions and lighting conditions.</p>
</blockquote>
<h3 id="image-capture"><a class="header" href="#image-capture">Image Capture</a></h3>
<p>Start by using <em>Capture ➔ Type ➔ Image Upload</em> dashboard option to upload a
<a href="quickstart/../images/target.jpg">test image</a> of a target.</p>
<img src="quickstart/../images/dash-img-upload.png" class="figure figure-90" />
<h3 id="mask-target"><a class="header" href="#mask-target">Mask Target</a></h3>
<p>Aquire contours that surround target reflections by adjusting the pipeline
mask parameters.</p>
<blockquote>
<p>Note: You can make the <em>hue</em>, <em>saturation</em>, and <em>value</em> adjustments in any
order, but we usually adjust value last and keep as wide a value range as
possible to account for different target viewing distances.</p>
</blockquote>
<p>Since the reflected light from the retro-reflective tape is a saturated color
we start by adjusting the <em>Mask ➔ Saturation</em> lower bound. While watching the
preview, increase the lower bound to a value that starts to remove
low-saturation pixels but retains all the target pixels that we are interested
in.</p>
<img src="quickstart/../images/dash-mask-sat.png" class="figure figure-90" />
<p>We use a specific green-colored light to illuminate the target so we can filter
out other colors by adjusting the <em>Mask ➔ Hue</em> lower and upper bounds until
just before the target pixels start to disappear.</p>
<img src="quickstart/../images/dash-mask-hue.png" class="figure figure-90" />
<p>Finally, since the retro-reflective target tape creates a bright reflection, we
adjust the <em>Mask ➔ Value</em> lower-bound to remove dim pixels and clean up the
reflected target mask.</p>
<img src="quickstart/../images/dash-mask-val.png" class="figure figure-90" />
<h3 id="filter-contours"><a class="header" href="#filter-contours">Filter Contours</a></h3>
<p>Our masked test target image contains spurious contours that need to be
filtered out. Set <em>Preview ➔ Contours ➔ Filtered</em> and adjust the filters until
you just have a single contour around the target left.</p>
<blockquote>
<p>Note: When tuning filters for an actual robot, some of the filter parameters
may be affected by camera viewing angle and distance as the robot moves
around the field. Be sure to test thoroughly!</p>
</blockquote>
<img src="quickstart/../images/dash-filter.png" class="figure figure-90" />
<p>The following adjustments can be made to filter contours.</p>
<ul>
<li><strong>Area:</strong> The ratio of the contour area to the total image area.</li>
<li><strong>Solidity:</strong> The ratio of the contour area to the convex shape that covers
the entire contour.</li>
<li><strong>Aspect:</strong> The ratio of width to height of the bounding box for the contour.</li>
</ul>
<h3 id="pipeline-logging"><a class="header" href="#pipeline-logging">Pipeline Logging</a></h3>
<p>Logging can be enabled in the dashboard to assist troubleshooting during
competitions. Here's an example of logging output from the pipeline we just
configured.</p>
<img src="quickstart/../images/1-1.jpg" class="figure figure-90" />
<div style="break-before: page; page-break-before: always;"></div><h1 id="create-robot-project"><a class="header" href="#create-robot-project">Create Robot Project</a></h1>
<p>Deadeye provides a Java client library (<a href="quickstart/../javadoc/">javadocs</a>) that can be
used in FRC robot programs to control and receive data from a Deadeye vision
co-processor. In this example, we'll use this library to connect to the Deadeye
pipeline we just configured and print out data about the sample image's
target.</p>
<h2 id="create-project"><a class="header" href="#create-project">Create Project</a></h2>
<p>We'll assume you are using <a href="https://docs.wpilib.org/en/stable/docs/software/vscode-overview/">VS Code with the WPILib extension</a>.</p>
<p>See the WPILib VS Code instructions for <a href="https://docs.wpilib.org/en/stable/docs/software/vscode-overview/creating-robot-program.html">creating a robot
program</a> and use the following settings for the <strong>New Project
Creator</strong>:</p>
<img src="quickstart/../images/wpi-new-project.png" class="screenshot" />
<h2 id="add-deadeye-library"><a class="header" href="#add-deadeye-library">Add Deadeye Library</a></h2>
<p>For FRC robot projects, the Java client library is provided via a vendordeps
file:</p>
<blockquote>
<p>Download from: <a href="http://maven.strykeforce.org/deadeye.json">http://maven.strykeforce.org/deadeye.json</a></p>
</blockquote>
<p>To install, use <em>VS Code ➔ Install new libraries (online)</em> and provide the
<code>deadeye.json</code> URL above.</p>
<p>Alternatively, you can install manually to your project vendordeps directory or
run the following Gradle task in your project directory to download and install
the Deadeye vendor dependency file:</p>
<pre><code class="language-console">$ ./gradlew vendordep --url=http://maven.strykeforce.org/deadeye.json
</code></pre>
<h2 id="robot-example"><a class="header" href="#robot-example">Robot Example</a></h2>
<p>We can now program our robot to access the Deadeye vision pipeline we just
configured above. Since the example above is a <code>UprightRectPipeline</code> for
Deadeye camera <code>F0</code> (seen at top of admin dashboard page), we'll use this
information when programming our robot below.</p>
<h3 id="deadeye-camera-class"><a class="header" href="#deadeye-camera-class">Deadeye Camera Class</a></h3>
<p>The recommended way to use the Deadeye client library is to create a class that
represents each Deadeye camera, <code>DeadeyeF0</code> in our case.</p>
<p>Pipelines are designed to be used with their corresponding <code>TargetData</code> type,
so our <code>deadeye::UprightRectPipeline</code> uses a <code>UprightRectTargetData</code>:</p>
<p>Create <code>src/main/java/frc/robot/subsystems/DeadeyeF0.java</code> (replace <code>F0</code> with
the camera you are actually using):</p>
<pre><code class="language-java">public class DeadeyeF0 implements TargetDataListener&lt;UprightRectTargetData&gt; {

  private final Deadeye&lt;UprightRectTargetData&gt; deadeye;

  public DeadeyeF0() {                                                // (1)
    deadeye = new Deadeye&lt;&gt;(&quot;F0&quot;, UprightRectTargetData.class);
    deadeye.setTargetDataListener(this);
  }

  public DeadeyeF0(NetworkTableInstance nti) {                        // (2)
    deadeye = new Deadeye&lt;&gt;(&quot;F0&quot;, UprightRectTargetData.class, nti);
    deadeye.setTargetDataListener(this);
  }

  public void setEnabled(boolean enabled) {                           // (3)
      deadeye.setEnabled(enabled);
  }

  @Override                                                           // (4)
  public void onTargetData(UprightRectTargetData data) {
      Point center = data.center;
      System.out.printf(&quot;x=%d, y=%d %n&quot;, center.x, center.y);
  }
}
</code></pre>
<p><strong>(1)</strong> Create a new <code>Deadeye</code> object instance that will expect
<code>UprightRectTargetData</code> from camera <code>F0</code> and that uses the default
<code>NetworkTablesInstance</code>. Register this object as the designated
<code>TargetDataListener</code> for camera <code>F0</code>.</p>
<p><strong>(2)</strong> Alternate constructor you may use if you are not using the default
<code>NetworkTablesInstance</code>. Normally this is <em>only</em> needed when you are using a
Deadeye or robot simulator and you are using a separate stand-alone
<code>NetworkTablesInstance</code> for Deadeye. This <a href="https://github.com/strykeforce/olympics/tree/main/vision">repo</a> contains an example of how to
use.</p>
<p><strong>(3)</strong> Enabled or disable camera <code>F0</code> pipeline. When enabled, the camera
lights will turn on and the pipeline will send target data.</p>
<p><strong>(4)</strong> Implements <code>TargetDataListener.onTargetData()</code> and is called for every
camera frame processed through <code>F0</code> pipeline. This example implementation
extracts the target center point and prints it.</p>
<h3 id="robot-class"><a class="header" href="#robot-class">Robot Class</a></h3>
<p>Normally you would integrate the camera <code>DeadeyeF0</code> class above into a robot
<code>Subsystem</code> and activate from a <code>Command</code> but we'll keep it simple for the
purposes of this example.</p>
<p>Make the following additions to the standard <code>Robot</code> class in
<code>src/main/java/frc/robot/Robot.java</code>.</p>
<p>Initialize our robot's <code>DeadeyeF0</code> object in the <code>robotInit()</code> method.</p>
<pre><code class="language-java">private DeadeyeF0 deadeyeF0;

@Override
public void robotInit() {
  // ...
  deadeyeF0 = new DeadeyeF0();
}
</code></pre>
<p>Enable camera <code>F0</code> when enabling the robot in tele-operation mode.</p>
<pre><code class="language-java">@Override
public void teleopInit() {
  // ...
  deadeyeF0.setEnabled(true);
}
</code></pre>
<p>And disable the camera when disabling the robot.</p>
<pre><code class="language-java">@Override
public void disabledInit() {
  deadeyeF0.setEnabled(false);
}
</code></pre>
<h3 id="deploy-and-run"><a class="header" href="#deploy-and-run">Deploy and Run</a></h3>
<p>If your pipeline is tuned as above you should see target data for the
sample image large target in the <strong>robot log</strong> when you enable the
robot:</p>
<pre><code>x=212, y=91
x=212, y=91
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration"><a class="header" href="#configuration">Configuration</a></h1>
<p>Deadeye pipelines are configured at build time by configuring CMake when
building directly during development or by editing <code>inventory.yaml</code> when
deploying with Ansible.</p>
<h2 id="deadeye-pipelines"><a class="header" href="#deadeye-pipelines">Deadeye Pipelines</a></h2>
<p>Deadeye has several general-purpose pipelines available that cover a
majority of use cases.</p>
<ul>
<li><code>UprightRectPipeline</code></li>
<li><code>MinAreaRectPipeline</code></li>
<li><code>TargetListPipeline</code></li>
</ul>
<p>Deadeye servers have a configuration file at <code>/etc/opt/deadeye/deadeye.conf</code></p>
<p>Deadeye vision server pipelines are configured by pointing your browser
to <code>http://&lt;address of Deadeye unit&gt;/</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="architecture"><a class="header" href="#architecture">Architecture</a></h1>
<p>Deadeye consists of software and hardware that together provide a vision
processing system for FRC robots. The main system components are identified in
the block diagram below. In addition to the main vision processing pipeline
shown in red, we have an adminstration dashboard in blue, and miscellaneous
services in yellow.</p>
<img src="images/block-diagram.svg" class="figure figure-80"/>
<p>Although typically used on a <a href="https://developer.nvidia.com/EMBEDDED/jetson-nano-developer-kit/">Jetson Nano Developer Kit</a>, the Deadeye
server software (vision process daemon and admin dashboard web server) can be
installed on any Linux system with the appropriate C++ compiler and development
libararies installed.</p>
<h2 id="software"><a class="header" href="#software">Software</a></h2>
<p>The Deadeye system has several components that run on a vision coprocessor,
client roboRIO and web browser. They communicate over the network and require a
running <a href="https://docs.wpilib.org/en/stable/docs/software/networktables/">NetworkTables</a> server.</p>
<h3 id="camera-pipeline-daemon"><a class="header" href="#camera-pipeline-daemon">Camera Pipeline Daemon</a></h3>
<p>The main vision processing process running on the vision coprocessor that
manages up to five cameras and associated target processing pipelines. Each
running instance is identified by a unit ID: A, B, C...</p>
<p>Communication is via NetworkTables for configuration and control via the <a href="architecture.html#web-admin-dashboard-server">web
admin dashboard server</a> and the <a href="architecture.html#java-client-library">Java client
library</a> and via UDP for streaming targeting data to the
Java client library. It also provides an on-demand camera video stream directly
to the <a href="architecture.html#web-admin-dashboard-client">web admin dashboard client</a> over TCP.</p>
<p>It runs as a systemd service named <code>deadeye-daemon.service</code>.</p>
<h3 id="java-client-library"><a class="header" href="#java-client-library">Java Client Library</a></h3>
<p>A Java client libary (<a href="javadoc/">javadocs</a>) used by FRC roboRIO robot code to
control and communicate with the <a href="architecture.html#camera-pipeline-daemon">camera pipeline
daemon</a> running on the vision co-processor.
Communication to other components is via NetworkTables for configuration and
control and to the camera pipeline daemon directly via UDP for streaming target
data.</p>
<p>See the <a href="quickstart/robot.html#add-deadeye-library">Quickstart</a> for installation
and usage instructions.</p>
<h3 id="web-admin-dashboard-server"><a class="header" href="#web-admin-dashboard-server">Web Admin Dashboard Server</a></h3>
<p>A Python web service running on the Nano that is the backend for the <a href="architecture.html#web-admin-dashboard-client">web admin
dashboard client</a>, that configures and controls
the <a href="architecture.html#camera-pipeline-daemon">camera pipeline daemon</a>.</p>
<p>Communication with the camera pipeline daemon is via NetworkTables and with the
web admin dashboard client via a websocket using the <a href="https://socket.io">Socket.IO</a>
protocol.</p>
<p>It runs as a systemd service named <code>deadeye-admin.service</code>.</p>
<h3 id="web-admin-dashboard-client"><a class="header" href="#web-admin-dashboard-client">Web Admin Dashboard Client</a></h3>
<p>The web-based adminstration dashboard run on a developer's computer used to
control, configure and monitor the <a href="architecture.html#camera-pipeline-daemon">camera pipeline
daemon</a>.</p>
<p>It communicates with the <a href="architecture.html#web-admin-dashboard-server">web admin dashboard
server</a> over websockets and streams camera preview
video directly from the camera pipeline daemon over TCP as MJPEG.</p>
<p>It can be loaded by connecting with a web browser to port 5000, for example,
<a href="http://10.27.67.10:5000/">http://10.27.67.10:5000/</a>.</p>
<h3 id="shutdown-service"><a class="header" href="#shutdown-service">Shutdown Service</a></h3>
<p>A background service running on the Nano that watches for a <a href="architecture.html#shutdown-switch">shutdown
button</a> press and performs a clean shutdown if it pressed for
three or more seconds.</p>
<p>It runs as a systemd service named <code>deadeye-shutdown.service</code>.</p>
<h2 id="hardware"><a class="header" href="#hardware">Hardware</a></h2>
<p>Deadeye software is designed to interact with cameras, lights and a
shutdown switch attached to the Jetson Nano.</p>
<h3 id="camera"><a class="header" href="#camera">Camera</a></h3>
<p>Any camera(s)
<a href="https://developer.nvidia.com/embedded/jetson-partner-supported-cameras">supported</a>
by the Nano can be used. Deadeye supports up to five attached cameras per unit.
Our default camera is a <a href="https://www.raspberrypi.org/products/camera-module-v2/">Raspberry Pi Camera Module
V2</a> connected to the
<code>J13 camera connector</code>.</p>
<h3 id="lights"><a class="header" href="#lights">Lights</a></h3>
<p>Our default vision processing pipeline relies on bright green LED
illumination reflected by retro-reflective target tape back to the
camera.</p>
<p>We drive the green LEDs using a LUXdrive A009-D-V-1000 BuckBlock LED
driver module.</p>
<img src="images/lights-schematic.svg" class="figure figure-50"/>
<p>Each camera can have its own light driver circuit and has GPIO output
assigned per table below.</p>
<table><thead><tr><th>Camera</th><th>J41 Pin</th></tr></thead><tbody>
<tr><td>0</td><td>19</td></tr>
<tr><td>1</td><td>21</td></tr>
<tr><td>2</td><td>23</td></tr>
<tr><td>3</td><td>24</td></tr>
<tr><td>4</td><td>26</td></tr>
</tbody></table>
<h3 id="shutdown-switch"><a class="header" href="#shutdown-switch">Shutdown Switch</a></h3>
<p>The <a href="architecture.html#shutdown-service">shutdown service</a> daemon checks <code>GPIO pin 7</code> of the
Nano <code>J41</code> header every second and will initiate a system shutdown if the input
is pulled high by the shutdown switch for three consecutive seconds.</p>
<img src="images/shutdown-schematic.svg" class="figure figure-50"/>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>This section describes how to prepare a Jetson Nano for Deadeye deployment. We
deploy the base Linux OS, and prepare the system for automated provisioning in
the next section.</p>
<blockquote>
<p>Note: This step is only done once for each SD card you prepare.</p>
</blockquote>
<h2 id="jetson-nano-developer-kit"><a class="header" href="#jetson-nano-developer-kit">Jetson Nano Developer Kit</a></h2>
<p>When you boot the first time from a freshly-imaged SD card, the will take you
through some initial set-up. Normally this is done with an attached monitor,
keyboard and mouse, but for convenience we will perform a &quot;headless&quot; set-up
over a USB serial connection.</p>
<h3 id="items-required"><a class="header" href="#items-required">Items Required</a></h3>
<p>Have the following items available before starting installation.</p>
<p><strong>microSD Card:</strong> The uses a microSD card as a boot device and for main
storage. It's important to have a card that's fast and large enough for your
projects; the minimum recommended is a 16GB UHS-1 card.</p>
<p><strong>5V 4A Power Supply:</strong> Normally the is powered via the micro-USB connector,
however we will be using it for serial communication during set-up. You'll
need to power the with a DC barrel jack power supply (with 5.5mm OD / 2.1mm ID
/ 9.5mm length, center pin positive) that can supply up to 5V 4A. See
<a href="https://www.adafruit.com/product/1466">Adafruit's 5V 4A switching power supply</a>.</p>
<p><strong>Circuit Board Jumper Cap:</strong> To enable use of the DC barrel jack power supply,
you will need to fit a jumper to J48 on the baseboard.</p>
<p><strong>USB Cable:</strong> You will use a micro-USB to USB A cable to connect to the Nano.
Make sure that the cable is data capable. Some USB cables (such as those that
come with phones) only transmit power.</p>
<p><strong>Ethernet Cable:</strong> For connecting to your network.</p>
<h3 id="first-boot"><a class="header" href="#first-boot">First Boot</a></h3>
<blockquote>
<p>Note: Start with the Nano unpowered; we will connect to power supply in a
step below.</p>
</blockquote>
<ol>
<li>Download the <a href="https://developer.nvidia.com/embedded/jetpack">Jetson NANO Developer Kit SD Card image</a> and install
it to your microSD card using <a href="https://www.balena.io/etcher/">balenaEtcher</a> or equivalent.</li>
<li>Install the microSD card into the slot on the underside of the
module.</li>
<li>Connect the USB cable between your computer and the Nano micro-USB
connector.</li>
<li>Connect the ethernet cable to your network.</li>
<li>Attach the circuit board jumper cap across <code>J48</code>.</li>
<li>Attach the 5v power supply to the <code>J25</code> power jack to boot the Nano.</li>
<li>When boot is complete, connect to the via USB serial. You will need a
serial terminal application such as <code>puTTY</code> for Windows or <code>screen</code> for
Linux and macOS. More information about connecting with a serial terminal
can be found at <a href="https://www.jetsonhacks.com/2019/08/21/jetson-nano-headless-setup/">JetsonHacks</a>.</li>
</ol>
<h3 id="initial-set-up"><a class="header" href="#initial-set-up">Initial Set-up</a></h3>
<p>When you boot the first time, the Developer Kit will take you through some
initial setup, including:</p>
<ol>
<li>Review and accept NVIDIA software EULA</li>
<li>Select system language, location, and time zone</li>
<li>System clock set to UTC: <strong>Yes</strong></li>
<li>User full name: <strong>Deadeye</strong></li>
<li>Username: <strong>deadeye</strong></li>
<li>Password: <em>use shop WiFi password</em></li>
<li>APP partition size: accept default value to use entire SD card</li>
<li>Network configuration: select <strong>eth0</strong> as the primary network
interface. If you are connected to a network via ethernet, you
should be assigned an IP address using DHCP. We will configure a
static IP address below.</li>
<li>Select a host name corresponding to the unit ID, for example, unit A
is <strong>deadeye-a</strong>.</li>
<li>Log back into the as user <strong>deadeye</strong> and reboot using <code>sudo reboot</code></li>
</ol>
<h2 id="2767-configuration"><a class="header" href="#2767-configuration">2767 Configuration</a></h2>
<p>For team 2767, computer name and IP address are according to the
following table:</p>
<table><thead><tr><th>Unit</th><th>Hostname</th><th>IP Address</th></tr></thead><tbody>
<tr><td>A</td><td>deadeye-a</td><td>10.27.67.10</td></tr>
<tr><td>B</td><td>deadeye-b</td><td>10.27.67.11</td></tr>
<tr><td>C</td><td>deadeye-c</td><td>10.27.67.12</td></tr>
<tr><td>D</td><td>deadeye-d</td><td>10.27.67.13</td></tr>
</tbody></table>
<p>The gateway and DNS server are <strong>10.27.67.1</strong> for all units.</p>
<blockquote>
<p><strong>Important:</strong> Make sure you have rebooted the after performing initial
set-up since its network interface will change after first boot.</p>
</blockquote>
<p>To finish configuration, log in as user <em>deadeye</em> and run the following
command to install the <code>curl</code> utility:</p>
<pre><code class="language-console">$ sudo apt install -y curl
</code></pre>
<p>When the <code>curl</code> utility is successfully installed, run our custom bootstrap
script:</p>
<pre><code class="language-console">$ curl https://www.strykeforce.org/deadeye/bootstrap.sh | sudo bash
</code></pre>
<p>Reboot the using <code>sudo reboot</code> and confirm you can log in remotely from your
computer via SSH: <code>ssh deadeye@10.27.67.12</code> (deadeye-c).</p>
<h2 id="miscellaneous"><a class="header" href="#miscellaneous">Miscellaneous</a></h2>
<p>Update installed packages, this may take a while depending on the number of
out-of-date packages:</p>
<pre><code class="language-console">$ sudo apt upgrade
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
                        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
                
    </body>
</html>
